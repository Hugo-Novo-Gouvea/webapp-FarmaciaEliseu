<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Vendas - Farmácia Eliseu</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/custom.css">
  <style>
    /* caixinha de sugestões que vamos usar pros clientes e pros produtos */
    .suggest-box {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(255,255,255,0.98);
      border: 1px solid rgba(0,0,0,.1);
      z-index: 50;
      max-height: 220px;
      overflow-y: auto;
      box-shadow: 0 8px 20px rgba(0,0,0,.12);
    }
    .suggest-item {
      padding: .25rem .5rem;
      cursor: pointer;
      font-size: .75rem;
      color: #333;
    }
    .suggest-item:hover {
      background: rgba(0,0,0,.04);
    }
    /* modalzinho de lookup de produto */
    .app-modal-xl {
      max-width: 780px;
    }
    #produto-lookup-table th,
    #produto-lookup-table td {
      font-size: .7rem;
    }
  </style>
</head>
<body class="app-body app-body-gradient">
  <main class="app-main">
    <div class="container">
      <div class="list-shell" id="vendas-shell">
        <!-- titulo -->
        <div class="mb-3">
          <h2 class="h5 mb-1">Vendas</h2>
        </div>

        <!-- barra de acoes -->
        <div class="action-bar">
          <button id="btn-sell" class="action-btn success" disabled>✏️ Realizar venda</button>
        </div>

        <!-- linha do menu (sem busca) -->
        <div class="list-filter">
          <div class="list-filter-action">
            <a href="/" class="btn-modern small">⬅️ Menu</a>
          </div>
        </div>

        <!-- LINHA 1: Tipo de venda | Vendedor | Tipo de cliente | Tipo de produto | Tipo de desconto -->
        <div class="list-filter">
          <div class="list-filter-field">
            <label for="tipo-venda">Tipo de venda *</label>
            <select id="tipo-venda">
              <option value="">Selecione o tipo</option>
              <option value="marcar">Marcar</option>
              <option value="dinheiro">Dinheiro</option>
            </select>
          </div>
          <div class="list-filter-field">
            <label for="vendedor">Vendedor *</label>
            <select id="vendedor">
              <option value="">Selecione o vendedor</option>
            </select>
          </div>
          <div class="list-filter-field">
            <label for="tipo-cliente">Tipo de cliente *</label>
            <select id="tipo-cliente">
              <option value="">Selecione o tipo</option>
              <option value="registrado">Registrado</option>
              <option value="avulso">Avulso</option>
            </select>
          </div>
          <div class="list-filter-field">
            <label for="tipo-produto">Tipo de produto *</label>
            <select id="tipo-produto">
              <option value="">Selecione</option>
              <option value="registrado">Registrado</option>
              <option value="avulso">Outras Vendas</option>
            </select>
          </div>
          <!-- NOVO: tipo de desconto -->
          <div class="list-filter-field">
            <label for="tipo-desconto">Tipo de desconto</label>
            <select id="tipo-desconto">
              <option value="porcentagem" selected>Porcentagem</option>
              <option value="fixo">Fixo</option>
            </select>
          </div>
        </div>

        <!-- LINHA 2: cliente REGISTRADO (agora é só input + sugestões + total) -->
        <div class="list-filter" id="cliente-registrado-block" style="display:none;">
          <div class="list-filter-input" style="min-width:280px; position:relative;">
            <label for="cliente-registrado-input">Cliente *</label>
            <input id="cliente-registrado-input" type="text" autocomplete="off" placeholder="digite para buscar..." />
            <div id="cliente-registrado-suggest" class="suggest-box" style="display:none;"></div>
          </div>
          <div class="list-filter-total">
            <!-- mesmo estilo do contas a receber -->
            <div id="vendas-total-cliente" class="table-pager-info">Total: R$ 0,00</div>
          </div>
        </div>

        <!-- LINHA 2 alternativa: cliente AVULSO -->
        <div class="list-filter" id="cliente-avulso-block" style="display:none;">
          <div class="list-filter-input" style="min-width:280px;">
            <label for="cliente-avulso">Cliente *</label>
            <input id="cliente-avulso" type="text" placeholder="nome do cliente avulso..." />
          </div>
        </div>

        <!-- LINHA 3: vendedor (oculta antiga) -->
        <div class="list-filter" style="display:none;">
          <div class="list-filter-field">
            <label for="vendedor">Vendedor *</label>
            <select id="vendedor-old">
              <option value="">Selecione o vendedor</option>
            </select>
          </div>
        </div>

        <!-- LINHA 4: produto + qtd + desconto + botão (produto registrado) -->
        <div class="list-filter vendas-itens-row" id="produto-registrado-block" style="display:none;">
          <div class="list-filter-input vendas-produto">
            <label for="produto">Código de barras / descrição *</label>
            <input id="produto" type="text" placeholder="leia o código ou digite a descrição..." />
          </div>
          <div class="list-filter-input vendas-qtd">
            <label for="quantidade">Quantidade</label>
            <input id="quantidade" type="number" min="1" value="1" />
          </div>
          <div class="list-filter-input vendas-desc">
            <label for="desconto" id="label-desconto-reg">Desconto (%)</label>
            <input id="desconto" type="number" min="0" step="0.01" value="0" />
          </div>
          <div class="list-filter-action vendas-add">
            <button id="btn-add-item" class="action-btn primary">Adicionar</button>
          </div>
        </div>

        <!-- LINHA 4 alternativa: produto AVULSO -->
        <div class="list-filter vendas-itens-row" id="produto-avulso-block" style="display:none;">
          <div class="list-filter-input vendas-produto" style="min-width:260px;">
            <label for="produto-nome">Nome do produto *</label>
            <input id="produto-nome" type="text" placeholder="descrição do item avulso..." />
          </div>
          <div class="list-filter-input vendas-preco">
            <label for="produto-preco">Preço de venda *</label>
            <input id="produto-preco" type="number" min="0" step="0.01" value="0" />
          </div>
          <div class="list-filter-input vendas-qtd">
            <label for="quantidade-avulso">Quantidade</label>
            <input id="quantidade-avulso" type="number" min="1" value="1" />
          </div>
          <div class="list-filter-input vendas-desc">
            <label for="desconto-avulso" id="label-desconto-avulso">Desconto (%)</label>
            <input id="desconto-avulso" type="number" min="0" step="0.01" value="0" />
          </div>
          <div class="list-filter-action vendas-add">
            <button id="btn-add-item-avulso" class="action-btn primary">Adicionar</button>
          </div>
        </div>

        <!-- tabela de itens -->
        <div class="table-shell">
          <div class="table-responsive app-table-wrapper">
            <table class="table-modern" id="tb-itens-venda">
              <thead>
                <tr>
                  <th>Produto</th>
                  <th>Qtd</th>
                  <th>Valor</th>
                  <th>Desconto</th>
                  <th>Total</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="6" class="text-center text-muted">Nenhum item adicionado...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </main>

  <!-- MODAL DE ESCOLHA DE PRODUTO POR DESCRIÇÃO -->
  <div class="app-modal-backdrop" id="produto-lookup-backdrop" style="display:none;">
    <div class="app-modal app-modal-xl">
      <div class="app-modal-header">
        <h2 class="h6 mb-0">Selecione o produto</h2>
        <button type="button" class="app-modal-close" id="produto-lookup-close">&times;</button>
      </div>
      <div class="app-modal-body">
        <p class="text-muted" style="font-size:.7rem;">Foram encontrados produtos com a descrição digitada. Escolha um.</p>
        <div class="table-responsive app-table-wrapper">
          <table class="table-modern" id="produto-lookup-table">
            <thead>
              <tr>
                <th>Descrição</th>
                <th>Cód. Barras</th>
                <th>Preço venda</th>
                <th style="width:60px;"></th>
              </tr>
            </thead>
            <tbody id="produto-lookup-tbody">
              <tr><td colspan="4" class="text-center text-muted">Carregando...</td></tr>
            </tbody>
          </table>
        </div>
        <div class="mt-3 text-end">
          <button class="btn-modern secondary small" id="produto-lookup-cancel">Cancelar</button>
          <button class="btn-modern primary small" id="produto-lookup-confirm">Confirmar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/vendas.js"></script>
</body>
</html>
