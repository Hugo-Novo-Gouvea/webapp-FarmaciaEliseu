<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Clientes - Farmácia Eliseu</title>
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <style>
    body {
      background: #f1f5f9;
    }
    .app-header {
      background: #0f172a;
    }
    .table thead th {
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark app-header mb-4">
    <div class="container d-flex justify-content-between align-items-center">
      <a href="index.html" class="navbar-brand">← Voltar</a>
      <span class="navbar-text text-light">Cadastro de clientes</span>
    </div>
  </nav>

  <div class="container pb-4">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h1 class="h5 mb-1">Clientes</h1>
            <p class="text-muted mb-0">Listagem vinda do SQL Server (tabela <code>clientes</code>).</p>
          </div>
          <!-- lugar pra botão de "Novo" no futuro -->
          <button class="btn btn-outline-secondary btn-sm" disabled>
            Novo (em breve)
          </button>
        </div>

        <div class="table-responsive" style="max-height: 60vh;">
          <table class="table table-striped table-hover table-sm align-middle" id="tb">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Endereço</th>
                <th>RG</th>
                <th>CPF</th>
                <th>Telefone</th>
                <th>Celular</th>
                <th>Data Nasc.</th>
                <th>Cód. Fichário</th>
                <th>Data Cadastro</th>
                <th>Último Registro</th>
                <th>Deletado</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="12" class="text-muted text-center">
                  Carregando...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
      <div class="card-footer bg-white text-muted small">
        Dados locais · atualizados na abertura da página
      </div>
    </div>
  </div>

  <script>
    fetch('/api/clientes')
      .then(r => r.json())
      .then(clientes => {
        const tbody = document.querySelector('#tb tbody');
        tbody.innerHTML = '';

        clientes.forEach(c => {
          const tr = document.createElement('tr');

          const dtNasc = c.dataNascimento ? new Date(c.dataNascimento).toLocaleDateString() : '';
          const dtCad = c.dataCadastro ? new Date(c.dataCadastro).toLocaleString() : '';
          const dtUlt = c.dataUltimoRegistro ? new Date(c.dataUltimoRegistro).toLocaleString() : '';

          tr.innerHTML = `
            <td>${c.clientesId ?? c.clientesID ?? ''}</td>
            <td>${c.nome ?? ''}</td>
            <td>${c.endereco ?? ''}</td>
            <td>${c.rg ?? ''}</td>
            <td>${c.cpf ?? ''}</td>
            <td>${c.telefone ?? ''}</td>
            <td>${c.celular ?? ''}</td>
            <td>${dtNasc}</td>
            <td>${c.codigoFichario ?? ''}</td>
            <td>${dtCad}</td>
            <td>${dtUlt}</td>
            <td>
              ${c.deletado ? '<span class="badge bg-danger">Sim</span>' : '<span class="badge bg-success">Não</span>'}
            </td>
          `;
          tbody.appendChild(tr);
        });

        if (clientes.length === 0) {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td colspan="12" class="text-center text-muted">Nenhum cliente encontrado.</td>`;
          tbody.appendChild(tr);
        }
      })
      .catch(err => {
        console.error(err);
        const tbody = document.querySelector('#tb tbody');
        tbody.innerHTML = `<tr><td colspan="12" class="text-center text-danger">Erro ao carregar clientes</td></tr>`;
      });
  </script>
</body>
</html>
